/*! mobify-maginifik 0.1.2 2014-05-30 */
(function(){var t=window.Adaptive,s=window.Mobify=window.Mobify||{};void 0===t.$&&(s.$=s.$||window.$||window.Zepto||window.jQuery);var i=t.$||s.$;s.UI=s.UI||{classPrefix:"m-"},s.UI.Magnifik=function(){var t={stage:void 0,classNames:{zooming:"zooming",close:"close",control:"magnifikControl",canvas:"magnifikCanvas",thumb:"magnifikThumb",full:"magnifikFull"},ratio:2,seekImage:!0,clickCloses:!0,activationEvent:"click",canvasStyle:{position:"absolute",width:"100%",height:"100%",overflow:"auto"},imageStyle:{position:"absolute",top:"0",left:"0",maxWidth:"none",maxHeight:"none"},stageHTML:function(){return'<div class="'+this._getClass("canvas")+'"><img class="'+this._getClass("thumb")+'"><img class="'+this._getClass("full")+'"></div>'},globalStyle:function(){var t="."+this._getClass("zooming");return t+" { overflow: hidden; }"+t+" > * { display: none !important; }"+t+" > ."+this._getClass("control")+" { display: block !important; }"}},e=function(s,o){this.options=i.extend({},e.defaults,o),this.options.classNames=i.extend(t.classNames,this.options.classNames),this.options.imageStyle.width=100*this.options.ratio+"%",this.options.stage||(this.options.stage=i("body"),this.options.global=!0),this.$element=i(s),this.bind()};return e.defaults=t,e.prototype.unbind=function(){return this.bind(!0)},e.prototype.makeElems=function(){if(this.$stage=this.options.stage,this.$canvas=i(this.options.stageHTML.call(this)).addClass(this._getClass("control")),this.$canvas.first().css(this.options.canvasStyle),this.$thumb=this.$canvas.find("."+this._getClass("thumb")).css(this.options.imageStyle),this.$full=this.$canvas.find("."+this._getClass("full")).css(this.options.imageStyle),this.options.clickCloses&&this.$canvas.first().addClass(this._getClass("close")),this.options.global){if(!i('style[data-magnifik="'+this._getClass("zooming")+'"]').length){var t=document.createElement("style"),s=this.options.globalStyle.call(this);t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s)),i("head")[0].appendChild(t)}}else this.$stage.css("position","relative");var e="."+this._getClass("close");this.$close=this.$canvas.find(e).add(this.$canvas.filter(e)),this.bindClose("bind")},e.prototype.close=function(){this.isOpen&&(this.isOpen=!1,this.$element.trigger("closing.magnifik"),this.$canvas.detach(),this.$stage.removeClass(this._getClass("zooming")),this.options.global&&(document.body.scrollTop=this.oldScrollTop),this.$element.trigger("close.magnifik"))},e.prototype.open=function(t){if(t.preventDefault(),!this.isOpen){this.isOpen=!0,this.$element.trigger("opening.magnifik"),this.$stage||this.makeElems();var s,e,o,n=.5,a=.5,l=i(t.target);if("IMG"!==t.target.tagName){var h=this.$element;this.options.seekImage&&(h=h.add(this.$element.parents()));for(var r=0;h.length>r;++r)if(e=i(h[r]).find("img"),e.length){l=e;break}}else n=t.offsetX/l.prop("offsetWidth"),a=t.offsetY/l.prop("offsetHeight");s=l.filter("[href]").add(l.parent("[href]")),o=s.attr("href")||l.attr("src"),this.$thumb.attr("src",l.attr("src")),this.$full.attr("src",o),this.options.global&&(this.oldScrollTop=document.body.scrollTop),this.$stage.append(this.$canvas),this.$stage.addClass(this._getClass("zooming"));var c=l.prop("naturalHeight")/l.prop("naturalWidth"),p=this.$thumb.prop("offsetWidth"),d=this.$canvas.prop("offsetWidth"),f=p,g=this.$canvas.prop("offsetHeight"),m=p*c,u=this;this.$thumb.one("load",function(){u.$canvas.prop("scrollLeft",Math.max(0,Math.min(f-d,f*n-d/2))),u.$canvas.prop("scrollTop",Math.max(0,Math.min(m-g,m*a-g/2))),u.$element.trigger("open.magnifik")})}},e.prototype.bindClose=function(t){this.$close&&this.$close[t](this.options.activationEvent,this.boundClose)},e.prototype.bind=function(t){var s=this,i=t?"unbind":"bind";this.boundClose=this.boundClose||function(){return s.close.apply(s,arguments)},this.boundOpen=this.boundOpen||function(){return s.open.apply(s,arguments)},this.$element[i](this.options.activationEvent,this.boundOpen),this.bindClose(i)},e.prototype._getClass=function(t){var i=this.options.classPrefix;return i===void 0&&(i=s.UI.classPrefix),i+this.options.classNames[t]},e}(),i.fn.magnifik=function(t,e){var o="Mobify.UI.Magnifik",n=i.extend({},i.fn.magnifik.defaults);return"object"==typeof t&&(n=t,e=null,t=null),this.each(function(){var a=i(this),l=a.data(o);l||(l=new s.UI.Magnifik(this,n)),t&&(l[t](e),"destroy"===t&&(a.data(o,null),a.$canvas.remove())),a.data(o,l)}),this}})();